---
- name: collect facts about system services
  service_facts:
  register: services_state

- name: "Check the status of systemd service Podman"
  assert:
    that:
      - services_state.ansible_facts.services['podman.service'].status == "enabled"

- name: "Check the Podman socket"
  become: true
  stat:
    path: "/var/run/podman/podman.sock"
  register: podman_sock

- name: "Check that the Podman socket file exists"
  assert:
    that:
      - podman_sock.stat.exists is true

- name: "Read the file ACL for the Podman socket"
  become: true
  acl:
    path: "/var/run/podman/podman.sock"
  register: acl_info

- name: "Check that the ACL contains a RW permission for the gitlab-runner user"
  assert:
    that:
      - "{{ 'user:gitlab-runner:rw-' in acl_info.acl }}"
